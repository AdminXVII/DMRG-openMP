# Configure file for compiling with ARM TX2 systems
# Execute from the main directory using ./configure/<configure_script>

BUILD_DIR=build_tx2

#The README instructions specify to copy one file to applyTarget.cpp
#to test new options

#Backup the original file
ORIGTARGET=apply_Htarget.cpp
BACKUPTARGET=apply_Htarget.cpp.orig
if [ ! -f $BACKUPTARGET ]; then
    echo "Making a backup"
    mv $ORIGTARGET $BACKUPTARGET
fi

#Copy over a new file
NEWTRGTDIR=workingOpenMP
#Update this line to test other options
#NEWTARGET=task_applyHtarget.cpp
#cp ${NEWTRGTDIR}/${NEWTARGET} ${ORIGTARGE}T

#Create a cmake build directory
mkdir -p ${BUILD_DIR} && cd ${BUILD_DIR}
rm -rf CMake*

#Make sure to use tabs rather than spaces for newline entries
#Specify the ThunderX2 flags to tune for the TX2 architecture
cmake -D CMAKE_BUILD_TYPE=Release \
        -D CMAKE_CXX_COMPILER=armclang \
        -D CMAKE_CXX_FLAGS="-mcpu=thunderx2t99 -mtune=thunderx2t99 -O3 -fopenmp" \
        -D CXX_STD=11 \
        ..
